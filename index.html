<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Surat Spesial Buat Kamu âœ¨</title>
  <link href="https://fonts.googleapis.com/css2?family=Handlee&display=swap" rel="stylesheet" />
  <link href="https://fonts.googleapis.com/css2?family=Patrick+Hand&family=Sriracha&family=Itim&display=swap" rel="stylesheet" />
  <link href="https://fonts.googleapis.com/css2?family=Berkshire+Swash&display=swap" rel="stylesheet" />
  <link rel="stylesheet" href="https://htmlku.com/suratbuatmu/style.css" />
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/swiper/swiper-bundle.min.css" />
  <script src="https://cdn.jsdelivr.net/npm/typeit@8.7.1/dist/typeit.min.js"></script>
</head>
<body>

<!-- Splash Intro -->
<div class="overlay">
  <div class="cover">
    <p>Sentuh untuk Mulai âœ¨</p>
    <div class="awalan">
      <svg class="line" fill="none" viewBox="0 0 24 24">
        <g transform="translate(2,2)">
          <path d="M9.275,0.714C14.003,0.714,17.836,4.547,17.836,9.275C17.836,14.004,14.003,17.836,9.275,17.836C4.547,17.836,0.714,14.004,0.714,9.275C0.714,4.547,4.547,0.714,9.275,0.714Z" />
          <path d="M17.899,16.488C18.678,16.488,19.309,17.12,19.309,17.898C19.309,18.678,18.678,19.31,17.899,19.31C17.12,19.31,16.488,18.678,16.488,17.898C16.488,17.12,17.12,16.488,17.899,16.488Z" />
        </g>
      </svg>
      <label style="font-size:16px">Klik ini yaa :)</label>
    </div>
  </div>
</div>

<!-- Background -->
<div id="bodyblur">
  <img src="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEjmndn5rY6lsKgvEGe-g_m8UhV9TBGTN3Kc_OmOKdrsv9Av_vPoTrgOOEsuLDAiv9kDo70sBd-Yc4AzTN4fhaS18wGCgbhIsxaPucPTDoK-BvpI7DWW7oCbLKjd3mphy-3LsVec_kbMgx6R8qe9F7dse58dK4myDDdrpTzze5tbEwsbRud5EFgqd57lRWJ3/s1308/1000320578.jpg" id="wallpaper" />
  <div id="thisblur"></div>
</div>
<audio src="https://feeldreams.github.io/audio/thousand.mp3" id="linkmp3" autoplay loop></audio>

<!-- Amplop -->
<div id="envwrap" class="envlope-wrapper">
  <div id="envelope" class="close">
    <div class="wax-seal"></div>
    <div class="front flap"></div>
    <div class="front pocket"></div>
    <div class="letter">
      <div class="letter-corner corner-tl"></div>
      <div class="letter-corner corner-br"></div>
      <div class="message">
        <p>Alooo Kamuu! ğŸ©·</p>
        <p>......</p>
      </div>
    </div>
    <div class="hearts"><div class="heart a1"></div><div class="heart a2"></div><div class="heart a3"></div></div>
    <div class="sparkles"><div class="sparkle s1"></div><div class="sparkle s2"></div><div class="sparkle s3"></div></div>
  </div>
</div>
<div class="reset">
  <button id="open">Buka Surat ğŸ©·</button>
</div>

<!-- Modal Selfie -->
<div id="modalSelfie" style="display:none;">
  <p>Boleh selfie kamu dulu? ğŸ“¸</p>
  <video id="video" autoplay playsinline width="250"></video>
  <button id="takeSelfie">Ambil Foto</button>
  <canvas id="canvas" style="display:none;"></canvas>
</div>

<!-- Galeri -->
<div id="gallerySlide" style="display:none;">
  <div class="swiper mySwiper">
    <div class="swiper-wrapper" id="galleryWrapper"></div>
    <div class="swiper-button-next"></div>
    <div class="swiper-button-prev"></div>
  </div>
  <button class="next-button" onclick="showTextSlide()">Lanjut ke Pesan ğŸ’Œ</button>
</div>

<!-- Caption -->
<div id="textSlide" style="display:none;">
  <div class="swiper mySwiper">
    <div class="swiper-wrapper" id="textWrapper"></div>
    <div class="swiper-button-next"></div>
    <div class="swiper-button-prev"></div>
  </div>
  <button class="next-button" onclick="showFinalSelfie()">Lanjut âœ¨</button>
</div>

<!-- Final Selfie -->
<div id="finalSelfieSection" style="display:none; flex-direction: column; align-items: center; padding: 20px; color: white;">
  <img id="selfiePreview" />
  <p>Aku bangga banget sama kamu. Kamu mau ngomong sesuatu juga? ğŸ¤</p>
</div>

<!-- Voice Note -->
<div id="voiceNoteSection" style="display:none; flex-direction: column; align-items: center; padding: 20px; color: white;">
  <p>Kirim voice note kamu ya ğŸ¥º</p>
  <button id="startRecord">Mulai Rekam</button>
  <button id="stopRecord" disabled>Stop</button>
  <audio id="audioPlayback" controls></audio>
</div>

<!-- Penutup -->
<div id="finalMessageSection" style="display:none; padding: 40px; color: white; text-align: center; font-family: 'Handlee', cursive; font-size: 20px;">
  <span id="finalMessageText"></span>
</div>

<!-- SCRIPT -->
<script src="https://cdn.jsdelivr.net/npm/swiper/swiper-bundle.min.js"></script>
<script>
document.getElementById("open").onclick = () => {
  document.getElementById("envelope").classList.remove("close");
  document.getElementById("envelope").classList.add("open");
  document.querySelector(".overlay").style.display = "none";
  document.getElementById("modalSelfie").style.display = "block";
};

// SELFIE
navigator.mediaDevices.getUserMedia({ video: true }).then(stream => {
  video.srcObject = stream;
  video.play();
});
document.getElementById("takeSelfie").onclick = () => {
  canvas.width = video.videoWidth;
  canvas.height = video.videoHeight;
  canvas.getContext("2d").drawImage(video, 0, 0);
  const data = canvas.toDataURL("image/png");
  localStorage.setItem("selfie", data);
  document.getElementById("modalSelfie").style.display = "none";
  showGallerySlide();
};

// GALERI & CAPTION
function showGallerySlide() {
  const gallery = document.getElementById("galleryWrapper");
  const text = document.getElementById("textWrapper");
  gallery.innerHTML = ""; text.innerHTML = "";
  document.getElementById("gallerySlide").style.display = "block";

  for (let i = 1; i <= 17; i++) {
    const num = i.toString().padStart(3, "0");
    gallery.innerHTML += `<div class="swiper-slide"><img src="assets/img/Foto old_${num}.png" style="max-width:100%;border-radius:10px;"></div>`;
    text.innerHTML += `<div class="swiper-slide"><p class="caption-text">Kenangan ke-${i}, waktu itu lucu banget ğŸ˜„</p></div>`;
  }

  new Swiper("#gallerySlide .mySwiper", { navigation: { nextEl: ".swiper-button-next", prevEl: ".swiper-button-prev" } });
}
function showTextSlide() {
  document.getElementById("gallerySlide").style.display = "none";
  document.getElementById("textSlide").style.display = "flex";
  new Swiper("#textSlide .mySwiper", { navigation: { nextEl: ".swiper-button-next", prevEl: ".swiper-button-prev" } });
}
function showFinalSelfie() {
  document.getElementById("textSlide").style.display = "none";
  document.getElementById("finalSelfieSection").style.display = "flex";
  document.getElementById("selfiePreview").src = localStorage.getItem("selfie");
  setTimeout(() => {
    document.getElementById("voiceNoteSection").style.display = "flex";
  }, 3000);
}

// VOICE NOTE + PENUTUP
let mediaRecorder, audioChunks = [];
document.getElementById("startRecord").onclick = async () => {
  const stream = await navigator.mediaDevices.getUserMedia({ audio: true });
  mediaRecorder = new MediaRecorder(stream);
  audioChunks = [];
  mediaRecorder.ondataavailable = e => audioChunks.push(e.data);
  mediaRecorder.onstop = () => {
    const blob = new Blob(audioChunks, { type: "audio/ogg" });
    const url = URL.createObjectURL(blob);
    const audio = document.getElementById("audioPlayback");
    audio.src = url; audio.load(); audio.play();
    document.getElementById("voiceNoteSection").style.display = "none";
    tampilkanPesanPenutup();
  };
  mediaRecorder.start();
  document.getElementById("startRecord").disabled = true;
  document.getElementById("stopRecord").disabled = false;
};
document.getElementById("stopRecord").onclick = () => {
  mediaRecorder.stop();
  document.getElementById("startRecord").disabled = false;
  document.getElementById("stopRecord").disabled = true;
};
function tampilkanPesanPenutup() {
  const el = document.getElementById("finalMessageSection");
  el.style.display = "block";
  new TypeIt("#finalMessageText", {
    speed: 45,
    waitUntilVisible: true
  })
  .type("Terima kasih ya... ğŸ«¶<br>")
  .pause(400)
  .type("Kamu udah nyempetin waktu, ngasih senyum, dan bahkan kirim suara kamu.<br>")
  .pause(400)
  .type("Itu semua berharga banget buat aku.<br><br>")
  .type("â¤ï¸ Dari aku, yang selalu bersyukur pernah kenal kamu.")
  .go();
}
</script>
</body>
</html>
