<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Surat Spesial Buat Kamu ‚ú®</title>
  <link href="https://fonts.googleapis.com/css2?family=Handlee&display=swap" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=Patrick+Hand&family=Sriracha&family=Itim&display=swap" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=Berkshire+Swash&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://htmlku.com/suratbuatmu/style.css">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/swiper/swiper-bundle.min.css" />
  <script src="https://cdn.jsdelivr.net/npm/typeit@8.7.1/dist/typeit.min.js"></script>
</head>
<body>

<!-- Splash Intro -->
<div class="overlay">
  <div class="cover">
    <p>Sentuh untuk Mulai ‚ú®</p>
    <div class="awalan">
      <svg class="line" fill="none" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
        <g transform="translate(2.000000, 2.000000)">
          <path d="M9.27542857,0.714285714 C14.0030476,0.714285714 17.836381,4.54666667 17.836381,9.2752381 C17.836381,14.0038095 14.0030476,17.8361905 9.27542857,17.8361905 C4.54685714,17.8361905 0.71447619,14.0038095 0.71447619,9.2752381 C0.71447619,4.54666667 4.54685714,0.714285714 9.27542857,0.714285714 Z"></path>
          <path d="M17.8989524,16.487619 C18.678,16.487619 19.3094286,17.12 19.3094286,17.8980952 C19.3094286,18.6780952 18.678,19.3095238 17.8989524,19.3095238 C17.1199048,19.3095238 16.4875238,18.6780952 16.4875238,17.8980952 C16.4875238,17.12 17.1199048,16.487619 17.8989524,16.487619 Z"></path>
        </g>
      </svg>
      <label style="font-size:16px">Klik ini yaa :)</label>
    </div>
  </div>
</div>

<!-- Background & Musik -->
<div id="bodyblur">
  <img src="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEjmndn5rY6lsKgvEGe-g_m8UhV9TBGTN3Kc_OmOKdrsv9Av_vPoTrgOOEsuLDAiv9kDo70sBd-Yc4AzTN4fhaS18wGCgbhIsxaPucPTDoK-BvpI7DWW7oCbLKjd3mphy-3LsVec_kbMgx6R8qe9F7dse58dK4myDDdrpTzze5tbEwsbRud5EFgqd57lRWJ3/s1308/1000320578.jpg" id="wallpaper">
  <div id="thisblur"></div>
</div>
<audio src="https://feeldreams.github.io/audio/thousand.mp3" id="linkmp3" autoplay loop></audio>

<!-- Amplop -->
<div id="envwrap" class="envlope-wrapper">
  <div id="envelope" class="close">
    <div class="wax-seal"></div>
    <div class="front flap"></div>
    <div class="front pocket"></div>
    <div class="letter">
      <div class="letter-corner corner-tl"></div>
      <div class="letter-corner corner-br"></div>
      <div class="message">
        <p>Alooo Kamuu! ü©∑</p>
        <p>......</p>
      </div>
    </div>
    <div class="hearts">
      <div class="heart a1"></div>
      <div class="heart a2"></div>
      <div class="heart a3"></div>
    </div>
    <div class="sparkles">
      <div class="sparkle s1"></div>
      <div class="sparkle s2"></div>
      <div class="sparkle s3"></div>
    </div>
  </div>
</div>
<div class="reset">
  <button id="open">Buka Surat ü©∑</button>
</div>

<!-- Modal Selfie -->
<div id="modalSelfie" style="display:none;">
  <p>Boleh selfie kamu dulu? üì∏</p>
  <video id="video" autoplay playsinline width="250"></video>
  <button id="takeSelfie">Ambil Foto</button>
  <canvas id="canvas" style="display:none;"></canvas>
</div>

<!-- Galeri -->
<div id="gallerySlide" style="display:none;">
  <div class="swiper mySwiper">
    <div class="swiper-wrapper" id="galleryWrapper"></div>
    <div class="swiper-button-next"></div>
    <div class="swiper-button-prev"></div>
  </div>
  <button class="next-button" onclick="showTextSlide()">Lanjut ke Pesan üíå</button>
</div>

<!-- Caption -->
<div id="textSlide" style="display:none;">
  <div class="swiper mySwiper">
    <div class="swiper-wrapper" id="textWrapper"></div>
    <div class="swiper-button-next"></div>
    <div class="swiper-button-prev"></div>
  </div>
  <button class="next-button" onclick="showFinalSelfie()">Lanjut ‚ú®</button>
</div>

<!-- Final Selfie -->
<div id="finalSelfieSection" style="display:none; flex-direction: column; align-items: center; padding: 20px; color: white;">
  <img id="selfiePreview" />
  <p>Aku bangga banget sama kamu. Kamu mau ngomong sesuatu juga? üé§</p>
</div>

<!-- Voice Note -->
<div id="voiceNoteSection" style="display:none; flex-direction: column; align-items: center; padding: 20px; color: white;">
  <p>Kirim voice note kamu ya ü•∫</p>
  <button id="startRecord">Mulai Rekam</button>
  <button id="stopRecord" disabled>Stop</button>
  <audio id="audioPlayback" controls></audio>
</div>

<!-- Penutup Ketikan -->
<div id="finalMessageSection" style="display:none; padding: 40px; color: white; text-align: center; font-family: 'Handlee', cursive; font-size: 20px;">
  <span id="finalMessageText"></span>
</div>

<!-- SCRIPT -->
<script src="https://cdn.jsdelivr.net/npm/swiper/swiper-bundle.min.js"></script>
<script>
let mediaRecorder, audioChunks = [];

const video = document.getElementById("video");
const canvas = document.getElementById("canvas");
const takeBtn = document.getElementById("takeSelfie");

navigator.mediaDevices.getUserMedia({ video: true }).then(stream => {
  video.srcObject = stream;
  video.play();
}).catch(() => alert("Kamera tidak bisa diakses üò¢"));

takeBtn.onclick = () => {
  canvas.width = video.videoWidth;
  canvas.height = video.videoHeight;
  canvas.getContext("2d").drawImage(video, 0, 0);
  const selfieData = canvas.toDataURL("image/png");
  localStorage.setItem("selfie", selfieData);
  document.getElementById("modalSelfie").style.display = "none";
  showGallerySlide();
};

function showGallerySlide() {
  const gallery = document.getElementById("galleryWrapper");
  const text = document.getElementById("textWrapper");
  gallery.innerHTML = "";
  text.innerHTML = "";
  document.getElementById("gallerySlide").style.display = "block";

  for (let i = 1; i <= 17; i++) {
    const num = i.toString().padStart(3, "0");
    const g = document.createElement("div");
    g.className = "swiper-slide";
    g.innerHTML = `<img src="assets/img/Foto old_${num}.png" style="max-width:100%; border-radius:10px;">`;
    gallery.appendChild(g);

    const t = document.createElement("div");
    t.className = "swiper-slide";
    t.innerHTML = `<p class="caption-text">Kenangan ke-${i}, waktu itu lucu banget üòÑ</p>`;
    text.appendChild(t);
  }

  new Swiper("#gallerySlide .mySwiper", {
    navigation: { nextEl: ".swiper-button-next", prevEl: ".swiper-button-prev" }
  });
}

function showTextSlide() {
  document.getElementById("gallerySlide").style.display = "none";
  document.getElementById("textSlide").style.display = "flex";

  new Swiper("#textSlide .mySwiper", {
    navigation: { nextEl: ".swiper-button-next", prevEl: ".swiper-button-prev" }
  });
}

function showFinalSelfie() {
  document.getElementById("textSlide").style.display = "none";
  const img = document.getElementById("selfiePreview");
  img.src = localStorage.getItem("selfie");
  document.getElementById("finalSelfieSection").style.display = "flex";
  setTimeout(() => {
    document.getElementById("voiceNoteSection").style.display = "flex";
  }, 3000);
}

document.getElementById("startRecord").onclick = async () => {
  const stream = await navigator.mediaDevices.getUserMedia({ audio: true });
  mediaRecorder = new MediaRecorder(stream);
  audioChunks = [];

  mediaRecorder.ondataavailable = (e) => audioChunks.push(e.data);
  mediaRecorder.onstop = () => {
    const blob = new Blob(audioChunks, { type: "audio/ogg; codecs=opus" });
    const url = URL.createObjectURL(blob);
    const audio = document.getElementById("audioPlayback");
    audio.src = url;
    audio.load(); audio.play();
    document.getElementById("voiceNoteSection").style.display = "none";
    tampilkanPesanPenutup();
  };

  mediaRecorder.start();
  document.getElementById("startRecord").disabled = true;
  document.getElementById("stopRecord").disabled = false;
};

document.getElementById("stopRecord").onclick = () => {
  mediaRecorder.stop();
  document.getElementById("startRecord").disabled = false;
  document.getElementById("stopRecord").disabled = true;
};

function tampilkanPesanPenutup() {
  const section = document.getElementById("finalMessageSection");
  const target = document.getElementById("finalMessageText");
  if (!section || !target) return;
  section.style.display = "block";
  new TypeIt("#finalMessageText", {
    speed: 45, waitUntilVisible: true
  })
  .type("Terima kasih ya... ü´∂<br>")
  .pause(400)
  .type("Kamu udah nyempetin waktu, ngasih senyum, dan bahkan kirim suara kamu.<br>")
  .pause(400)
  .type("Itu semua berharga banget buat aku.<br><br>")
  .type("‚ù§Ô∏è Dari aku, yang selalu bersyukur pernah kenal kamu.")
  .go();
}
</script>
</body>
</html>
